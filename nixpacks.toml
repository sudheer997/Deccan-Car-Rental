[phases.setup]
nixPkgs = ["nodejs", "yarn"]

[phases.install]
cmds = ["yarn install --frozen-lockfile"]

[phases.build]
cmds = [
  "echo '=== Building Next.js application ==='",
  "yarn build",
  "echo '=== Copying static files ==='",
  "cp -rv .next/static .next/standalone/.next/ || echo 'Static copy failed'",
  "cp -rv public .next/standalone/ || echo 'Public copy failed'",
  "echo '=== Verifying standalone structure ==='",
  "ls -la .next/standalone/",
  "ls -la .next/standalone/.next/ || echo 'No .next in standalone'",
  "echo '=== Build complete ==='"
]

[start]
cmd = "node .next/standalone/server.js"
